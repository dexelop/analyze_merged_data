# 04. 증빙유형별 분석

## 개요

계정과목별 증빙 유형 분포 및 증빙률 분석

---

## 증빙유형 코드

| 코드 | 증빙유형명 | 증빙 인정 | 비고 |
|:----:|------------|:--------:|------|
| 0 | 수기 | X | 직접 입력 |
| 1 | 현금조정 | X | 현금/인출금 대체 |
| 5 | 결산분개 | X | 결산 시 자동 생성 |
| 40 | 원천세 | X | 급여 관련 |
| 86 | 세금계산서 | O | 매출/매입 |
| 87 | 영세율 | O | 영세율 세금계산서 |
| 88 | 카드 | O | 신용카드 |
| 88.5 | 카드미반영 | X | 시스템 예측 |
| 89 | 현금영수증 | O | 현금영수증 |
| 90 | 통장자동 | X | 은행 연동 |

---

## 로직

### Step 1: 증빙유형명 매핑

```python
EVIDENCE_NAMES = {
    0: '수기',
    1: '현금조정',
    5: '결산분개',
    40: '원천세',
    86: '세금계산서',
    87: '영세율',
    88: '카드',
    88.5: '카드미반영',
    89: '현금영수증',
    90: '통장자동'
}

df['증빙유형명'] = df['증빙유형'].map(EVIDENCE_NAMES)
df['증빙유형명'] = df['증빙유형명'].fillna(df['증빙유형'].astype(str))
```

### Step 2: 피벗 테이블 생성

```python
evidence_analysis = df.pivot_table(
    index=['손익분류', '계정과목'],
    columns='증빙유형명',
    values='순액',
    aggfunc='sum',
    fill_value=0
)
```

### Step 3: 합계 및 증빙률 계산

```python
# 합계
evidence_analysis['합계'] = evidence_analysis.sum(axis=1)

# 증빙금액 (세금계산서 + 카드 + 현금영수증)
vat_cols = ['세금계산서', '카드', '현금영수증']
evidence_analysis['증빙금액'] = evidence_analysis[
    [c for c in vat_cols if c in evidence_analysis.columns]
].sum(axis=1)

# 증빙률 (%)
evidence_analysis['증빙률'] = (
    evidence_analysis['증빙금액'] /
    evidence_analysis['합계'].replace(0, 1) * 100
).round(1)
```

---

## 목표 결과물

```
손익분류  계정과목        세금계산서   카드   현금영수증   수기   통장자동   합계      증빙률
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
판관비   복리후생비(판)     50,000   800,000   100,000  50,000     0    1,000,000   95.0%
         지급수수료(판)    600,000   200,000    50,000 100,000  50,000  1,000,000   85.0%
         직원급여(판)           0         0         0      0  19,800,000 19,800,000    0%
```

---

## 증빙률 해석

| 증빙률 | 상태 | 권장 조치 |
|:------:|------|----------|
| 90%+ | 양호 | 유지 |
| 70~90% | 주의 | 점검 필요 |
| 70% 미만 | 위험 | 개선 필요 |

---

## 출력 형식

### Excel (증빙유형별 시트)

MultiIndex 형태 그대로 출력

### JSON

```json
{
  "증빙유형별": [
    {
      "손익분류": "판관비",
      "계정과목": "복리후생비(판)",
      "세금계산서": 50000,
      "카드": 800000,
      "현금영수증": 100000,
      "수기": 50000,
      "합계": 1000000,
      "증빙금액": 950000,
      "증빙률": 95.0
    },
    ...
  ]
}
```

---

## 주의사항

1. **증빙 인정 기준**: 86, 87, 88, 89만 증빙으로 인정
2. **카드미반영 제외**: 88.5는 증빙 금액에서 제외
3. **0으로 나누기 방지**: `합계.replace(0, 1)` 처리
